<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link href="http://121.36.18.123/bootstrap/css/button.css" type="text/css" rel="stylesheet">
    <link href="http://121.36.18.123/808gps/open/css/video.css" type="text/css" rel="stylesheet">
    <script type="text/javascript"
            src="http://121.36.18.123/808gps/open/player/js/cmsv6player.min.js"></script>
    <script>
        var isInitFinished = false;//视频插件是否加载完成
        var swfobject;

        var lang = new langZhCn();

        function langZhCn() {

            this.geSessionId = "获取会话号";
            this.userId = "用户名：";
            this.password = "密码：";
            this.login = "登陆";
            this.videoInit = "初始化";
            this.videoLang = "插件语言：";
            this.videoWidth = "插件宽度：";
            this.videoHeight = "插件高度：";
            this.vodModeTitle = "插件模式";
            this.realMode = "实时视频";
            this.vodMode = "视频回放";
            this.serverPort = "端口：";
            this.settings = "设置";
            this.windowIndex = "窗口下标：";
            this.title = "标题：";
            this.jsession = "会话号：";
            this.stream = "码流：";
            this.devIdno = "设备号：";
            this.channel = "通道：";
            this.play = "播放";
            this.stop = "停止";
            this.reset = "重置";
            this.url = "url链接：";
            this.playback = "远程回放";
            this.loginError = "登陆失败";
            this.vedioStatus = "选中窗口播放状态";
            this.playbackDesc = "h5播放器，初始化时将isVodMode配置为true，则可以有回放工具栏，可以进行拖动操作。h5播放器同时可以支持多路同步回放 startVodM(url, \"0,1,2,3\")，需要设备支持多路同步回放，第二个参数\"0,1,2,3\"表示回放的通道";
            this.singleChannel = '单通道播放'
            this.multiChannel = '多通道同步回放'
            this.multiChannelUnSync = '多通道同时回放'
            this.getPlaybackLink = '获取播放连接'
            this.deviceNoError = '设备号错误'
        }

        function getUrlParameter(name) {
            if (location.search == '') {
                return '';
            }

            var o = {};
            var search = location.search.replace(/\?/, '');//只替换第一个问号,如果参数中带有问号,当作普通文本
            var s = search.split('&');
            for (var i = 0; i < s.length; i++) {
                o[s[i].split('=')[0]] = s[i].split('=')[1];
            }
            return o[name] == undefined ? '' : o[name];
        }

        function setText(domId, val) {
            var domItem = document.getElementById(domId);
            if (domItem != null) {
                domItem.innerHTML = val;
            }
        }

        function setValue(domId, val) {
            var domItem = document.getElementById(domId);
            if (domItem != null) {
                domItem.value = val;
            }
        }

        function getValue(domId) {
            var domItem = document.getElementById(domId);
            if (domItem != null) {
                return domItem.value;
            } else {
                return "";
            }
        }

        function setFocus(domId) {
            var domItem = document.getElementById(domId);
            if (domItem != null) {
                domItem.focus();
            }
        }

        function loadLang() {
            setText('getJsessionTitle', lang.geSessionId);
            setText('accountTitle', lang.userId);
            setText('passwordTitle', lang.password);
            setText('userLoginBtn', lang.login);
            setText('isPlay', lang.vedioStatus);
            setText('videoInitTitle', lang.videoInit);
            setText('videoInitBtn', lang.videoInit);
            setText('videoLangTitle', lang.videoLang);
            setText('videoWidthTitle', lang.videoWidth);
            setText('videoHeightTitle', lang.videoHeight);
            setText('vodModeTitle', lang.vodModeTitle);

            var objOption = document.createElement("OPTION");
            objOption.value = "0";
            objOption.text = lang.realMode;
            document.getElementById("vodMode").add(objOption);
            objOption = document.createElement("OPTION");
            objOption.value = "1";
            objOption.text = lang.vodMode;
            document.getElementById("vodMode").add(objOption);
            document.getElementById("vodMode").value = "1";

            

            setText('videoTitleTitle', lang.title);
            setText('videoStreamTitle', lang.stream);
            setText('videoPlayBtn', lang.play);
            setText('videoResetBtn', lang.reset);



            setText('playbackTitle', lang.playback);
            setText('urlTitle', lang.url);
            setText('urlTitle2', lang.url);
            setText('urlTitle3', lang.url);
            setText('playbackBtn', lang.playback);

            
            setText('aServerPort', lang.serverPort);
            setText('settings', lang.settings);
            setText('windowIndex', lang.windowIndex);
            setText('jsessionId', lang.jsession);
            setText('realDevIdnoTitle', lang.devIdno);
            setText('listenDevIdnoTitle', lang.devIdno);
            setText('talkDevIdnoTitle', lang.devIdno);
            setText('playbackDevIdnoTitle', lang.devIdno);

            setText('realDevChannelTitle', lang.channel);
            setText('listenDevChannelTitle', lang.channel);

            setText('stop', lang.stop);
            setText('playbackDesc', lang.playbackDesc);
            setText('talkbackDesc', lang.talkbackDesc);

            setText('setLangBtn', lang.settings);
            setText('setServerBtn', lang.settings);
            setText('setWndBtn', lang.settings);
            setText('initBtn', lang.settings);
            setText('setTitleBtn', lang.settings);
            setText('setBufferBtn', lang.settings);

            setText('videoStopBtn', lang.stop);
            setText('monitorStopBtn', lang.stop);
            setText('talkStopBtn', lang.stop);
            setText('playbackStopBtn', lang.stop);

            setText('playbackChannelTitle', lang.channel);
            setText('playbackTypeSpan1', lang.singleChannel)
            setText('playbackTypeSpan2', lang.multiChannel)
            setText('playbackTypeSpan3', lang.multiChannelUnSync)

        }

        function onReady() {
            var host = '121.36.90.54:'
            var ip = host.split(":")[0];
            var strLang = getUrlParameter('lang');
            loadLang();

            //初始化视频插件
            initPlayerExample();
        }

        //初始化视频插件
        function initPlayerExample() {
            for (var i = 0; i < 101; i++) {
                playingStatusArray.push(false);
            }
            var _isVodMode = getValue('vodMode');
            //赋值初始化为未完成
            isInitFinished = false;
            //视频插件宽度
            var width = getValue('playerWidth');
            if (width == '') {
                setFocus('playerWidth');
                return;
            }
            //视频插件高度
            var hieght = getValue('playerHeight');
            if (hieght == '') {
                setFocus('playerHeight');
                return;
            }
            var strLang = getUrlParameter('lang');
            var options = {
                domId: "cmsv6flash",
                isVodMode: true,
                width: width,
                height: hieght,
                lang: strLang == "" ? "en" : strLang
            }
            swfobject = new Cmsv6Player(options);
            initFlash();
        }

        //插件初始化完成后执行
        function initFlash() {
            if (typeof swfobject == "undefined" ||
                typeof swfobject.setWindowNum == "undefined") {
                setTimeout(initFlash, 50);
            } else {
                //初始化插件语言
                var language = 'cn.xml';
                swfobject.setLanguage(language);
                //先将全部窗口创建好
                swfobject.setWindowNum(36);
                //再配置当前的窗口数目
                var windowNum = 4;
                swfobject.setWindowNum(windowNum);
                //设置服务器信息
                var serverIp = '121.36.90.54';
                var serverPort = '6604';
                swfobject.setServerInfo(serverIp, serverPort);
                isInitFinished = true;

                // 监听回放Radio
                monitorPlaybackRadio()
            }
        }

        // 开始远程回放
        function startPlayback() {
            if (!isInitFinished) {
                return;
            } else {
                //回放url
                // var url = getValue('playbackUrl');
                // var url = `ws://121.36.90.54:6604/3/5?DownType=5&jsession=${getValue('liveJsession')}&DevIDNO=014447934929&FILELOC=1&FILESVR=0&FILECHN=0&FILEBEG=63678&FILEEND=65151&PLAYIFRM=0&PLAYFILE=;0;0;21;10;20;63678;65151;0;0_0_0_1&PLAYBEG=0&PLAYEND=0&PLAYCHN=0&YEAR=21&MON=10&DAY=20`;
                var url = `ws://121.36.90.54:6604/3/5?DownType=5&jsession=${getValue('liveJsession')}&DevIDNO=014487901322&FILELOC=1&FILESVR=0&FILECHN=0&FILEBEG=41415&FILEEND=43642&PLAYIFRM=0&PLAYFILE=;0;0;21;10;20;41415;43642;0;0_0_0_1&PLAYBEG=0&PLAYEND=0&PLAYCHN=0&YEAR=21&MON=10&DAY=20`;
                if (url == '') {
                    setFocus('playbackUrl');
                    return;
                }
                //flash begin -----
                //回放之前先停止
                //swfobject.getObjectById('cmsv6flash').stopVideo(0);
                //开始回放
                //swfobject.getObjectById("cmsv6flash").startVod(0, url);
                //flash end ------
                //h5 begin -----
                //回放之前先停止
                swfobject.stopVodM();

                var playbackChannelCount = 0
                var playbackChannelObj = document.getElementById("playbackChannel")
                if (playbackChannelObj) {
                    playbackChannelCount = playbackChannelObj.value
                }

                var playbackUrlObj2 = document.getElementById('playbackUrl2')
                var playbackUrlObj3 = document.getElementById('playbackUrl2')

                var urls = []
                if (playbackUrlObj2.value) {
                    urls.push(playbackUrlObj2.value)
                    if (playbackUrlObj3.value) {
                        urls.push(playbackUrlObj3.value)
                    }
                }

                if (document.getElementById('playbackType3').checked) {
                    urls.push(url)
                    // urls = []
                    //开始回放
                    swfobject.startVodM(urls, "");
                } else {
                    console.log(url, playbackChannelCount,'--------');
                    swfobject.startVodM(url, playbackChannelCount);
                }

                //h5 end ------
            }
        }

        function monitorPlaybackRadio() {
            document.getElementById("playbackRadio").addEventListener("click", function (e) {
                if (e.target.tagName === "INPUT") {
                    var playbackChannelObj = document.getElementById("playbackChannel")
                    var playbackChannelObj2 = document.getElementById("playbackChannel2")
                    var playbackChannelObj3 = document.getElementById("playbackChannel3")
                    switch (e.target.value) {
                        case "1":
                            playbackChannelObj.value = "0"
                            playbackChannelObj.disabled = 'disabled'
                            playbackChannelObj2.style.display = 'none'
                            playbackChannelObj3.style.display = 'none'
                            break
                        case "2":
                            playbackChannelObj.value = "0,1,2"
                            playbackChannelObj.disabled = ''
                            playbackChannelObj2.style.display = 'none'
                            playbackChannelObj3.style.display = 'none'
                            break
                        case "3":
                            playbackChannelObj.value = ""
                            playbackChannelObj.disabled = 'disabled'
                            playbackChannelObj2.style.display = ''
                            playbackChannelObj3.style.display = ''
                            break
                    }
                }
            })
        }
        var channel = ''

        function getPlaybackLink() {

            var serverIp = '121.36.90.54';
            var serverPort = '6604';
            var devIdno = getValue('playbackDevIdno');
            if (!devIdno) {
                setFocus('playbackDevIdno');
                return;
            }

            var jsession = getValue('liveJsession');
            if (!jsession) {
                setFocus('liveJsession');
                return;
            }

            console.log(location.protocol,'location.protocol');
            var _url = location.protocol + '//' + window.location.host + '/StandardApiAction_getVideoFileInfo.action?DevIDNO=' + devIdno + '&LOC=1&CHN=0&YEAR=2014&MON=12&DAY=10&RECTYPE=-1&FILEATTR=2&BEG=0&END=86399&ARM1=0&ARM2=0&RES=0&STREAM=0&STORE=0&jsession=' + jsession

            ajax({
                type: 'POST',
                url: _url,
                cache: false,
                dataType: 'json',
                success: function (data) {
                    if (data.result == 0) {
                        var files = data.files
                        if (files.length > 0) {
                            var firstFile = files[0]
                            if (firstFile.PlaybackUrlWs) {
                                setValue('playbackUrl', firstFile.PlaybackUrlWs)
                            } else {
                                setValue('playbackUrl', firstFile.PlaybackUrl)
                            }

                            var secondFile = files[1]
                            if (secondFile && secondFile.PlaybackUrlWs) {
                                var playbackUrlObj2 = document.getElementById('playbackUrl2')
                                playbackUrlObj2.value = secondFile.PlaybackUrlWs
                            }

                            var thirdFile = files[2]
                            if (thirdFile && thirdFile.PlaybackUrlWs) {
                                var playbackUrlObj3 = document.getElementById('playbackUrl3')
                                playbackUrlObj3.value = thirdFile.PlaybackUrlWs
                            }

                        }
                    } else if (data.result === 32) {
                        alert(lang.deviceNoError)
                        setFocus('playbackDevIdno');
                    } else {
                        alert(lang.loginError);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    try {
                        if (p.onError) p.onError(XMLHttpRequest, textStatus, errorThrown);
                    } catch (e) {
                    }
                    alert(lang.loginError);
                }
            })
        }

        function ajax() {
            var ajaxData = {
                type: arguments[0].type || "GET",
                url: arguments[0].url || "",
                async: arguments[0].async || "true",
                data: arguments[0].data || null,
                dataType: arguments[0].dataType || "text",
                contentType: arguments[0].contentType || "application/x-www-form-urlencoded",
                beforeSend: arguments[0].beforeSend || function () {
                },
                success: arguments[0].success || function () {
                },
                error: arguments[0].error || function () {
                }
            }
            ajaxData.beforeSend()
            var xhr = createxmlHttpRequest();
            xhr.responseType = ajaxData.dataType;
            xhr.open(ajaxData.type, ajaxData.url, ajaxData.async);
            xhr.setRequestHeader("Content-Type", ajaxData.contentType);
            xhr.send(convertData(ajaxData.data));
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4) {
                    if (xhr.status == 200) {
                        ajaxData.success(xhr.response)
                    } else {
                        ajaxData.error()
                    }
                }
            }
        }

        function createxmlHttpRequest() {
            if (window.ActiveXObject) {
                return new ActiveXObject("Microsoft.XMLHTTP");
            } else if (window.XMLHttpRequest) {
                return new XMLHttpRequest();
            }
        }

        function convertData(data) {
            if (typeof data === 'object') {
                var convertResult = "";
                for (var c in data) {
                    convertResult += c + "=" + data[c] + "&";
                }
                convertResult = convertResult.substring(0, convertResult.length - 1)
                return convertResult;
            } else {
                return data;
            }
        }

        //用户登录
        function userLogin() {
            //用户名
            var account = getValue('account');
            if (account == '') {
                setFocus('account');
                return;
            }
            //密码
            var password = getValue('userPassword');
            if (password == '') {
                setFocus('userPassword');
                return;
            }
            // var _url = location.protocol + '//' + window.location.host + '/StandardApiAction_login.action?account=' + account
            //     + "&password=" + password;
            ajax({
                type: 'GET',
                url: 'https://www.api.gosmooth.com.cn/jsession/get?account=myyfb&password=myyfb123',
                cache: false,
                // dataType: 'json',
                success: function (data) {
                    if (JSON.parse(data).result == 0) {
                        setValue('liveJsession', JSON.parse(data).jsession);
                    } else {
                        alert(lang.loginError);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    try {
                        if (p.onError) p.onError(XMLHttpRequest, textStatus, errorThrown);
                    } catch (e) {
                    }
                    alert(lang.loginError);
                }
            });
        }
        var selectIndex = 0;
        var playingStatusArray = [];
    </script>
</head>
<body onload="onReady();">

<div id="flashExample">
    <div id="cmsv6flash"></div>
    <div></div>
    <div id="eventTip"></div>
</div>

<div id="operateExample">
    <!--  用户登录开始 -->
    <div class="userLogin">
        <p id="descTitle"></p>
        <p id="getJsessionTitle">登录获取会话号</p>
        <div class="player-params">
            <div class="player-param">
                <a class="title" id="accountTitle">用户名：</a>
                <input style="width: 150px;" value="myyfb" id="account">
                <a style="padding-left: 20px;" class="title" id="passwordTitle">密码：</a>
                <input type="password" style="width: 150px;" value="myyfb123" id="userPassword">
            </div>
            <div class="player-param">
                <a id="userLoginBtn" class="button button-primary button-rounded button-small"
                   onclick="userLogin();">登录</a>
            </div>
            <div class="player-param">
                <a id="jsessionId" class="title">会话号：</a>
                <input style="width: 300px;" value="" id="liveJsession">
            </div>
        </div>
    </div>
    <!--  用户登录结束 -->
    <!--  视频插件初始化开始  -->
    <div class="videoInit">
        <p id="videoInitTitle">初始化</p>
        <div class="player-params">
            <div class="player-param">
                <a class="title" id="vodModeTitle">插件模式：</a>
                <select style="width: 140px;" id="vodMode">
                </select>
                <a class="title" id="videoWidthTitle">插件宽度：</a>
                <input style="width: 140px;" value="400" id="playerWidth">
                <a style="padding-left: 20px;" class="title" id="videoHeightTitle">插件高度：</a>
                <input style="width: 140px;" value="400" id="playerHeight">
            </div>

            <div class="player-param">
                <a id="videoInitBtn" class="button button-primary button-rounded button-small"
                   onclick="initPlayerExample();" id="initBtn">初始化</a>
            </div>
        </div>
    </div>
    <!--  视频插件初始化结束  -->

    <!--  远程回放开始  -->
    <div class="playback">
        <p id="playbackTitle">远程回放</p>
        <div class="player-params">
            <div class="player-param">
                <a id="urlTitle" class="title">url链接：</a>
                <textarea style="width: 400px;height:100px;" id="playbackUrl"></textarea>
            </div>

            <div class="player-param">
                <a class="title" id="playbackDevIdnoTitle">设备号：</a>
                <input style="width: 400px;" value="500000" id="playbackDevIdno">
            </div>

            <a id="getPlaybackLinkBtn" class="button button-primary button-rounded button-small"
               onclick="getPlaybackLink();">获取播放连接</a>

            <div style="padding-bottom: 10px">
                <span id="playbackDesc" style="font-size:10px;">h5播放器，初始化时将isVodMode配置为true，则可以有回放工具栏，可以进行拖动操作。h5播放器同时可以支持多路同步回放 startVodM(url, "0,1,2,3")，需要设备支持多路同步回放，第二个参数"0,1,2,3"表示回放的通道</span>
            </div>

            <div class="player-param">
                <div id="playbackRadio">
                    <input type="radio" id="playbackType1" name="playbackType" value="1" checked><span
                        id="playbackTypeSpan1"></span>
                    <input type="radio" id="playbackType2" name="playbackType" value="2"><span
                        id="playbackTypeSpan2"></span>
                    <input type="radio" id="playbackType3" name="playbackType" value="3"><span
                        id="playbackTypeSpan3"></span>
                </div>
            </div>

            <div class="player-param" id="playbackChannel2" style="display: none;">
                <a id="urlTitle2" class="title">url链接2：</a>
                <textarea style="width: 400px;height:100px;" id="playbackUrl2"></textarea>
            </div>

            <div class="player-param" id="playbackChannel3" style="display: none;">
                <a id="urlTitle3" class="title">url链接3：</a>
                <textarea style="width: 400px;height:100px;" id="playbackUrl3"></textarea>
            </div>

            <div class="player-param">
                <a style="padding-left: 20px;" class="title" id="playbackChannelTitle">通道：</a>
                <input style="width: 100px;" value="0" id="playbackChannel" disabled>
            </div>

            <div class="player-param">
                <a id="playbackBtn" class="button button-primary button-rounded button-small"
                   onclick="startPlayback();">开始回放</a>
            </div>
        </div>
    </div>
    <!--  远程回放开始  -->
</div>

</body>
</html>
</body>
</html>